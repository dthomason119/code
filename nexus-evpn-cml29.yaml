lab:
  description: Cisco Nexus 9K BGP EVPN VXLAN Topology - 2 Spines, 6 Leafs with vPC
  notes: |-
    BGP EVPN VXLAN Spine-Leaf Architecture
    - 2 Spine Switches (Route Reflectors)
    - 6 Leaf Switches in 3 vPC pairs
    - VLANs 10-20 mapped to VNIs
    - 4 Tenant VRFs with L3 VNI
    
    CML 2.9 Compatible
    Import Instructions:
    1. Login to CML at http://192.168.15.6
    2. Go to Labs -> Import
    3. Upload this YAML file
    4. Start lab and apply configurations from .txt files
  title: Nexus-9K-EVPN-VXLAN
  version: 0.2.0

nodes:
  - id: n0
    label: SPINE-01
    node_definition: nxosv9000
    x: -400
    y: -200
    configuration: |
      ! Configuration will be applied from spine-01.txt
      hostname SPINE-01
    image_definition: nxosv-9000
    compute_id: null
    tags: ["spine"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i4
        label: Ethernet1/4
        slot: 4
        type: physical
      - id: i5
        label: Ethernet1/5
        slot: 5
        type: physical
      - id: i6
        label: Ethernet1/6
        slot: 6
        type: physical

  - id: n1
    label: SPINE-02
    node_definition: nxosv9000
    x: 400
    y: -200
    configuration: |
      ! Configuration will be applied from spine-02.txt
      hostname SPINE-02
    image_definition: nxosv-9000
    compute_id: null
    tags: ["spine"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i4
        label: Ethernet1/4
        slot: 4
        type: physical
      - id: i5
        label: Ethernet1/5
        slot: 5
        type: physical
      - id: i6
        label: Ethernet1/6
        slot: 6
        type: physical

  - id: n2
    label: LEAF-01
    node_definition: nxosv9000
    x: -600
    y: 100
    configuration: |
      ! Configuration will be applied from leaf-01.txt
      hostname LEAF-01
    image_definition: nxosv-9000
    compute_id: null
    tags: ["leaf", "vpc-pair-1"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n3
    label: LEAF-02
    node_definition: nxosv9000
    x: -400
    y: 100
    configuration: |
      ! Configuration will be applied from leaf-02.txt
      hostname LEAF-02
    image_definition: nxosv-9000
    compute_id: null
    tags: ["leaf", "vpc-pair-1"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n4
    label: LEAF-03
    node_definition: nxosv9000
    x: -200
    y: 100
    configuration: |
      ! Configuration will be applied from leaf-03.txt
      hostname LEAF-03
    image_definition: nxosv-9000
    compute_id: null
    tags: ["leaf", "vpc-pair-2"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n5
    label: LEAF-04
    node_definition: nxosv9000
    x: 0
    y: 100
    configuration: |
      ! Configuration will be applied from leaf-04.txt
      hostname LEAF-04
    image_definition: nxosv-9000
    compute_id: null
    tags: ["leaf", "vpc-pair-2"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n6
    label: LEAF-05
    node_definition: nxosv9000
    x: 200
    y: 100
    configuration: |
      ! Configuration will be applied from leaf-05.txt
      hostname LEAF-05
    image_definition: nxosv-9000
    compute_id: null
    tags: ["leaf", "vpc-pair-3"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n7
    label: LEAF-06
    node_definition: nxosv9000
    x: 400
    y: 100
    configuration: |
      ! Configuration will be applied from leaf-06.txt
      hostname LEAF-06
    image_definition: nxosv-9000
    compute_id: null
    tags: ["leaf", "vpc-pair-3"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

links:
  # SPINE-01 to Leafs (Underlay)
  - id: l0
    n1: n0
    n2: n2
    i1: i1
    i2: i1
    label: SPINE-01-Eth1/1-to-LEAF-01-Eth1/1

  - id: l1
    n1: n0
    n2: n3
    i1: i2
    i2: i1
    label: SPINE-01-Eth1/2-to-LEAF-02-Eth1/1

  - id: l2
    n1: n0
    n2: n4
    i1: i3
    i2: i1
    label: SPINE-01-Eth1/3-to-LEAF-03-Eth1/1

  - id: l3
    n1: n0
    n2: n5
    i1: i4
    i2: i1
    label: SPINE-01-Eth1/4-to-LEAF-04-Eth1/1

  - id: l4
    n1: n0
    n2: n6
    i1: i5
    i2: i1
    label: SPINE-01-Eth1/5-to-LEAF-05-Eth1/1

  - id: l5
    n1: n0
    n2: n7
    i1: i6
    i2: i1
    label: SPINE-01-Eth1/6-to-LEAF-06-Eth1/1

  # SPINE-02 to Leafs (Underlay)
  - id: l6
    n1: n1
    n2: n2
    i1: i1
    i2: i2
    label: SPINE-02-Eth1/1-to-LEAF-01-Eth1/2

  - id: l7
    n1: n1
    n2: n3
    i1: i2
    i2: i2
    label: SPINE-02-Eth1/2-to-LEAF-02-Eth1/2

  - id: l8
    n1: n1
    n2: n4
    i1: i3
    i2: i2
    label: SPINE-02-Eth1/3-to-LEAF-03-Eth1/2

  - id: l9
    n1: n1
    n2: n5
    i1: i4
    i2: i2
    label: SPINE-02-Eth1/4-to-LEAF-04-Eth1/2

  - id: l10
    n1: n1
    n2: n6
    i1: i5
    i2: i2
    label: SPINE-02-Eth1/5-to-LEAF-05-Eth1/2

  - id: l11
    n1: n1
    n2: n7
    i1: i6
    i2: i2
    label: SPINE-02-Eth1/6-to-LEAF-06-Eth1/2

  # vPC Peer-Links - LEAF-01 and LEAF-02 (vPC Domain 1)
  - id: l12
    n1: n2
    n2: n3
    i1: i47
    i2: i47
    label: vPC-PeerLink-Pair1-Eth47

  - id: l13
    n1: n2
    n2: n3
    i1: i48
    i2: i48
    label: vPC-PeerLink-Pair1-Eth48

  # vPC Peer-Links - LEAF-03 and LEAF-04 (vPC Domain 2)
  - id: l14
    n1: n4
    n2: n5
    i1: i47
    i2: i47
    label: vPC-PeerLink-Pair2-Eth47

  - id: l15
    n1: n4
    n2: n5
    i1: i48
    i2: i48
    label: vPC-PeerLink-Pair2-Eth48

  # vPC Peer-Links - LEAF-05 and LEAF-06 (vPC Domain 3)
  - id: l16
    n1: n6
    n2: n7
    i1: i47
    i2: i47
    label: vPC-PeerLink-Pair3-Eth47

  - id: l17
    n1: n6
    n2: n7
    i1: i48
    i2: i48
    label: vPC-PeerLink-Pair3-Eth48
