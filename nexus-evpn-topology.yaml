lab:
  description: Cisco Nexus 9K BGP EVPN VXLAN Topology - 2 Spines, 6 Leafs with vPC + 4 Hosts
  notes: |-
    BGP EVPN VXLAN Spine-Leaf Architecture
    - 2 Spine Switches (Route Reflectors)
    - 6 Leaf Switches in 3 vPC pairs
    - 4 Ubuntu Hosts connected to first 4 leafs
    - VLANs 10-20 mapped to VNIs
    - 4 Tenant VRFs with L3 VNI
    
    Host Configuration:
    - HOST-01: 10.10.10.10/24 (VLAN 10 - TENANT_A_WEB)
    - HOST-02: 10.10.11.10/24 (VLAN 11 - TENANT_A_APP)
    - HOST-03: 10.10.13.10/24 (VLAN 13 - TENANT_B_WEB)
    - HOST-04: 10.10.14.10/24 (VLAN 14 - TENANT_B_APP)
    
    CML 2.9 Compatible
  title: Nexus-9K-EVPN-VXLAN
  version: 0.3.0

nodes:
  - id: n0
    label: SPINE-01
    node_definition: nxosv9000
    x: -400
    y: -200
    configuration: |
      hostname SPINE-01
    image_definition: nxosv-9000
    tags: ["spine"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i4
        label: Ethernet1/4
        slot: 4
        type: physical
      - id: i5
        label: Ethernet1/5
        slot: 5
        type: physical
      - id: i6
        label: Ethernet1/6
        slot: 6
        type: physical

  - id: n1
    label: SPINE-02
    node_definition: nxosv9000
    x: 400
    y: -200
    configuration: |
      hostname SPINE-02
    image_definition: nxosv-9000
    tags: ["spine"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i4
        label: Ethernet1/4
        slot: 4
        type: physical
      - id: i5
        label: Ethernet1/5
        slot: 5
        type: physical
      - id: i6
        label: Ethernet1/6
        slot: 6
        type: physical

  - id: n2
    label: LEAF-01
    node_definition: nxosv9000
    x: -600
    y: 100
    configuration: |
      hostname LEAF-01
    image_definition: nxosv-9000
    tags: ["leaf", "vpc-pair-1"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n3
    label: LEAF-02
    node_definition: nxosv9000
    x: -400
    y: 100
    configuration: |
      hostname LEAF-02
    image_definition: nxosv-9000
    tags: ["leaf", "vpc-pair-1"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n4
    label: LEAF-03
    node_definition: nxosv9000
    x: -200
    y: 100
    configuration: |
      hostname LEAF-03
    image_definition: nxosv-9000
    tags: ["leaf", "vpc-pair-2"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n5
    label: LEAF-04
    node_definition: nxosv9000
    x: 0
    y: 100
    configuration: |
      hostname LEAF-04
    image_definition: nxosv-9000
    tags: ["leaf", "vpc-pair-2"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i3
        label: Ethernet1/3
        slot: 3
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n6
    label: LEAF-05
    node_definition: nxosv9000
    x: 200
    y: 100
    configuration: |
      hostname LEAF-05
    image_definition: nxosv-9000
    tags: ["leaf", "vpc-pair-3"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n7
    label: LEAF-06
    node_definition: nxosv9000
    x: 400
    y: 100
    configuration: |
      hostname LEAF-06
    image_definition: nxosv-9000
    tags: ["leaf", "vpc-pair-3"]
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: Ethernet1/1
        slot: 1
        type: physical
      - id: i2
        label: Ethernet1/2
        slot: 2
        type: physical
      - id: i47
        label: Ethernet1/47
        slot: 47
        type: physical
      - id: i48
        label: Ethernet1/48
        slot: 48
        type: physical

  - id: n8
    label: HOST-01
    node_definition: ubuntu
    x: -600
    y: 300
    configuration: |
      #cloud-config
      hostname: host-01
      system_info:
        default_user:
          name: admin
      runcmd:
        - ip addr add 10.10.10.10/24 dev ens2
        - ip route add default via 10.10.10.1
        - echo "nameserver 8.8.8.8" > /etc/resolv.conf
    image_definition: ubuntu-22-04
    tags: ["host", "vlan10"]
    interfaces:
      - id: i0
        label: ens2
        slot: 0
        type: physical
      - id: i1
        label: ens3
        slot: 1
        type: physical

  - id: n9
    label: HOST-02
    node_definition: ubuntu
    x: -400
    y: 300
    configuration: |
      #cloud-config
      hostname: host-02
      system_info:
        default_user:
          name: admin
      runcmd:
        - ip addr add 10.10.11.10/24 dev ens2
        - ip route add default via 10.10.11.1
        - echo "nameserver 8.8.8.8" > /etc/resolv.conf
    image_definition: ubuntu-22-04
    tags: ["host", "vlan11"]
    interfaces:
      - id: i0
        label: ens2
        slot: 0
        type: physical
      - id: i1
        label: ens3
        slot: 1
        type: physical

  - id: n10
    label: HOST-03
    node_definition: ubuntu
    x: -200
    y: 300
    configuration: |
      #cloud-config
      hostname: host-03
      system_info:
        default_user:
          name: admin
      runcmd:
        - ip addr add 10.10.13.10/24 dev ens2
        - ip route add default via 10.10.13.1
        - echo "nameserver 8.8.8.8" > /etc/resolv.conf
    image_definition: ubuntu-22-04
    tags: ["host", "vlan13"]
    interfaces:
      - id: i0
        label: ens2
        slot: 0
        type: physical
      - id: i1
        label: ens3
        slot: 1
        type: physical

  - id: n11
    label: HOST-04
    node_definition: ubuntu
    x: 0
    y: 300
    configuration: |
      #cloud-config
      hostname: host-04
      system_info:
        default_user:
          name: admin
      runcmd:
        - ip addr add 10.10.14.10/24 dev ens2
        - ip route add default via 10.10.14.1
        - echo "nameserver 8.8.8.8" > /etc/resolv.conf
    image_definition: ubuntu-22-04
    tags: ["host", "vlan14"]
    interfaces:
      - id: i0
        label: ens2
        slot: 0
        type: physical
      - id: i1
        label: ens3
        slot: 1
        type: physical

links:
  - id: l0
    n1: n0
    n2: n2
    i1: i1
    i2: i1
    label: SPINE-01-Eth1/1-to-LEAF-01-Eth1/1

  - id: l1
    n1: n0
    n2: n3
    i1: i2
    i2: i1
    label: SPINE-01-Eth1/2-to-LEAF-02-Eth1/1

  - id: l2
    n1: n0
    n2: n4
    i1: i3
    i2: i1
    label: SPINE-01-Eth1/3-to-LEAF-03-Eth1/1

  - id: l3
    n1: n0
    n2: n5
    i1: i4
    i2: i1
    label: SPINE-01-Eth1/4-to-LEAF-04-Eth1/1

  - id: l4
    n1: n0
    n2: n6
    i1: i5
    i2: i1
    label: SPINE-01-Eth1/5-to-LEAF-05-Eth1/1

  - id: l5
    n1: n0
    n2: n7
    i1: i6
    i2: i1
    label: SPINE-01-Eth1/6-to-LEAF-06-Eth1/1

  - id: l6
    n1: n1
    n2: n2
    i1: i1
    i2: i2
    label: SPINE-02-Eth1/1-to-LEAF-01-Eth1/2

  - id: l7
    n1: n1
    n2: n3
    i1: i2
    i2: i2
    label: SPINE-02-Eth1/2-to-LEAF-02-Eth1/2

  - id: l8
    n1: n1
    n2: n4
    i1: i3
    i2: i2
    label: SPINE-02-Eth1/3-to-LEAF-03-Eth1/2

  - id: l9
    n1: n1
    n2: n5
    i1: i4
    i2: i2
    label: SPINE-02-Eth1/4-to-LEAF-04-Eth1/2

  - id: l10
    n1: n1
    n2: n6
    i1: i5
    i2: i2
    label: SPINE-02-Eth1/5-to-LEAF-05-Eth1/2

  - id: l11
    n1: n1
    n2: n7
    i1: i6
    i2: i2
    label: SPINE-02-Eth1/6-to-LEAF-06-Eth1/2

  - id: l12
    n1: n2
    n2: n3
    i1: i47
    i2: i47
    label: vPC-PeerLink-Pair1-Eth47

  - id: l13
    n1: n2
    n2: n3
    i1: i48
    i2: i48
    label: vPC-PeerLink-Pair1-Eth48

  - id: l14
    n1: n4
    n2: n5
    i1: i47
    i2: i47
    label: vPC-PeerLink-Pair2-Eth47

  - id: l15
    n1: n4
    n2: n5
    i1: i48
    i2: i48
    label: vPC-PeerLink-Pair2-Eth48

  - id: l16
    n1: n6
    n2: n7
    i1: i47
    i2: i47
    label: vPC-PeerLink-Pair3-Eth47

  - id: l17
    n1: n6
    n2: n7
    i1: i48
    i2: i48
    label: vPC-PeerLink-Pair3-Eth48

  # Host Links
  - id: l18
    n1: n2
    n2: n8
    i1: i3
    i2: i1
    label: LEAF-01-Eth1/3-to-HOST-01

  - id: l19
    n1: n3
    n2: n9
    i1: i3
    i2: i1
    label: LEAF-02-Eth1/3-to-HOST-02

  - id: l20
    n1: n4
    n2: n10
    i1: i3
    i2: i1
    label: LEAF-03-Eth1/3-to-HOST-03

  - id: l21
    n1: n5
    n2: n11
    i1: i3
    i2: i1
    label: LEAF-04-Eth1/3-to-HOST-04
